-- THIS FILE WAS AUTOMATICALLY GENERATED BY AENEAS
-- [iterators_scalar]
import Aeneas
open Aeneas.Std Result Error
set_option linter.dupNamespace false
set_option linter.hashCommand false
set_option linter.unusedVariables false

namespace iterators_scalar

/- Trait declaration: [core::iter::adapters::zip::TrustedRandomAccessNoCoerce]
   Source: '/rustc/library/core/src/iter/adapters/zip.rs', lines 585:0-585:51
   Name pattern: [core::iter::adapters::zip::TrustedRandomAccessNoCoerce] -/
@[rust_trait "core::iter::adapters::zip::TrustedRandomAccessNoCoerce"
  (consts := ["MAY_HAVE_SIDE_EFFECT"])]
structure core.iter.adapters.zip.TrustedRandomAccessNoCoerce (Self : Type)
  where
  MAY_HAVE_SIDE_EFFECT : Bool

/- Trait declaration: [core::iter::range::Step]
   Source: '/rustc/library/core/src/iter/range.rs', lines 25:0-25:42
   Name pattern: [core::iter::range::Step] -/
@[rust_trait "core::iter::range::Step"
  (parentClauses := ["cloneCloneInst", "cmpPartialOrdInst"])]
structure core.iter.range.Step (Self : Type) where
  cloneCloneInst : core.clone.Clone Self
  cmpPartialOrdInst : core.cmp.PartialOrd Self Self
  steps_between : Self → Self → Result (Usize × (Option Usize))
  forward_checked : Self → Usize → Result (Option Self)
  backward_checked : Self → Usize → Result (Option Self)

/- [core::iter::range::{core::iter::range::Step for usize}::steps_between]:
   Source: '/rustc/library/core/src/iter/range.rs', lines 263:16-263:84
   Name pattern: [core::iter::range::{core::iter::range::Step<usize>}::steps_between] -/
@[rust_fun
  "core::iter::range::{core::iter::range::Step<usize>}::steps_between"]
def core.iter.range.StepUsize.steps_between
  : Usize → Usize → Result (Usize × (Option Usize)) :=
  λ start end_ =>
    if h: start > end_ then ok ⟨ 0#usize, none ⟩ else
      let steps := Usize.ofNatCore (end_.val - start.val) (by scalar_tac)
      ok ⟨ steps, some steps ⟩

/- [core::iter::range::{core::iter::range::Step for usize}::forward_checked]:
   Source: '/rustc/library/core/src/iter/range.rs', lines 274:16-274:73
   Name pattern: [core::iter::range::{core::iter::range::Step<usize>}::forward_checked] -/
@[rust_fun
  "core::iter::range::{core::iter::range::Step<usize>}::forward_checked"]
def core.iter.range.StepUsize.forward_checked
  : Usize → Usize → Result (Option Usize) :=
  λ start n => ok (Usize.checked_add start n)

/- [core::iter::range::{core::iter::range::Step for usize}::backward_checked]:
   Source: '/rustc/library/core/src/iter/range.rs', lines 282:16-282:74
   Name pattern: [core::iter::range::{core::iter::range::Step<usize>}::backward_checked] -/
@[rust_fun
  "core::iter::range::{core::iter::range::Step<usize>}::backward_checked"]
def core.iter.range.StepUsize.backward_checked
  : Usize → Usize → Result (Option Usize) :=
  λ start n => ok (Usize.checked_sub start n)

/- Trait implementation: [core::iter::range::{core::iter::range::Step for usize}]
   Source: '/rustc/library/core/src/iter/range.rs', lines 258:12-258:37
   Name pattern: [core::iter::range::Step<usize>] -/
@[reducible, rust_trait_impl "core::iter::range::Step<usize>"]
def core.iter.range.StepUsize : core.iter.range.Step Usize := {
  cloneCloneInst := core.clone.CloneUsize
  cmpPartialOrdInst := core.cmp.PartialOrdUsize
  steps_between := core.iter.range.StepUsize.steps_between
  forward_checked := core.iter.range.StepUsize.forward_checked
  backward_checked := core.iter.range.StepUsize.backward_checked
}

/- Trait declaration: [core::iter::traits::iterator::Iterator]
   Source: '/rustc/library/core/src/iter/traits/iterator.rs', lines 40:0-40:18
   Name pattern: [core::iter::traits::iterator::Iterator] -/
@[rust_trait "core::iter::traits::iterator::Iterator"]
structure core.iter.traits.iterator.Iterator (Self : Type) (Self_Item : Type)
  where
  next : Self → Result ((Option Self_Item) × Self)

/- [core::iter::range::{core::iter::traits::iterator::Iterator<A> for core::ops::range::Range<A>}::next]:
   Source: '/rustc/library/core/src/iter/range.rs', lines 849:4-849:35
   Name pattern: [core::iter::range::{core::iter::traits::iterator::Iterator<core::ops::range::Range<@A>, @A>}::next] -/
@[rust_fun
  "core::iter::range::{core::iter::traits::iterator::Iterator<core::ops::range::Range<@A>, @A>}::next"]
def core.iter.range.IteratorcoreopsrangeRangeA.next
  {A : Type} (StepInst : core.iter.range.Step A) :
  core.ops.range.Range A → Result ((Option A) × (core.ops.range.Range A)) :=
  λ range => do
    let cmp ← StepInst.cmpPartialOrdInst.lt range.start range.end_;
    if cmp then
      let range' ← StepInst.cloneCloneInst.clone range.start;
      let n ← StepInst.forward_checked range' 1#usize;
      match n with
      | none => fail .panic -- Step invariants not upheld
      | some n => ok ⟨ some n, {range with start := n} ⟩
    else ok ⟨ none, range ⟩

/- Trait implementation: [core::iter::range::{core::iter::traits::iterator::Iterator<A> for core::ops::range::Range<A>}]
   Source: '/rustc/library/core/src/iter/range.rs', lines 845:0-845:40
   Name pattern: [core::iter::traits::iterator::Iterator<core::ops::range::Range<@A>, @A>] -/
@[reducible, rust_trait_impl
  "core::iter::traits::iterator::Iterator<core::ops::range::Range<@A>, @A>"]
def core.iter.traits.iterator.IteratorcoreopsrangeRangeA {A : Type} (StepInst :
  core.iter.range.Step A) : core.iter.traits.iterator.Iterator
  (core.ops.range.Range A) A := {
  next := core.iter.range.IteratorcoreopsrangeRangeA.next StepInst
}

/- Trait declaration: [core::iter::traits::accum::Sum]
   Source: '/rustc/library/core/src/iter/traits/accum.rs', lines 17:0-17:30
   Name pattern: [core::iter::traits::accum::Sum] -/
@[rust_trait "core::iter::traits::accum::Sum"]
structure core.iter.traits.accum.Sum (Self : Type) (A : Type) where
  sum : forall {I : Type} (iteratorIteratorInst :
    core.iter.traits.iterator.Iterator I A), I → Result Self

/- Trait declaration: [core::iter::traits::accum::Product]
   Source: '/rustc/library/core/src/iter/traits/accum.rs', lines 38:0-38:34
   Name pattern: [core::iter::traits::accum::Product] -/
@[rust_trait "core::iter::traits::accum::Product"]
structure core.iter.traits.accum.Product (Self : Type) (A : Type) where
  product : forall {I : Type} (iteratorIteratorInst :
    core.iter.traits.iterator.Iterator I A), I → Result Self

/- Trait declaration: [core::iter::traits::collect::IntoIterator]
   Source: '/rustc/library/core/src/iter/traits/collect.rs', lines 282:0-282:22
   Name pattern: [core::iter::traits::collect::IntoIterator] -/
@[rust_trait "core::iter::traits::collect::IntoIterator"
  (parentClauses := ["iteratorIteratorInst"])]
structure core.iter.traits.collect.IntoIterator (Self : Type) (Self_Item :
  Type) (Self_IntoIter : Type) where
  iteratorIteratorInst : core.iter.traits.iterator.Iterator Self_IntoIter
    Self_Item
  into_iter : Self → Result Self_IntoIter

/- Trait declaration: [core::iter::traits::collect::FromIterator]
   Source: '/rustc/library/core/src/iter/traits/collect.rs', lines 134:0-134:32
   Name pattern: [core::iter::traits::collect::FromIterator] -/
@[rust_trait "core::iter::traits::collect::FromIterator"]
structure core.iter.traits.collect.FromIterator (Self : Type) (A : Type) where
  from_iter : forall {T : Type} {Clause0_IntoIter : Type} (IntoIteratorInst :
    core.iter.traits.collect.IntoIterator T A Clause0_IntoIter), T → Result
    Self

/- [core::iter::traits::collect::{core::iter::traits::collect::IntoIterator<Clause0_Item, I> for I}::into_iter]:
   Source: '/rustc/library/core/src/iter/traits/collect.rs', lines 319:4-319:27
   Name pattern: [core::iter::traits::collect::{core::iter::traits::collect::IntoIterator<@I, @Clause0_Item, @I>}::into_iter] -/
@[rust_fun
  "core::iter::traits::collect::{core::iter::traits::collect::IntoIterator<@I, @Clause0_Item, @I>}::into_iter"]
def core.iter.traits.collect.IntoIterator.Blanket.into_iter
  {I : Type} {Clause0_Item : Type} (iteratorIteratorInst :
  core.iter.traits.iterator.Iterator I Clause0_Item) :
  I → Result I :=
    λ x => ok x

/- Trait implementation: [core::iter::traits::collect::{core::iter::traits::collect::IntoIterator<Clause0_Item, I> for I}]
   Source: '/rustc/library/core/src/iter/traits/collect.rs', lines 314:0-314:36
   Name pattern: [core::iter::traits::collect::IntoIterator<@I, @Clause0_Item, @I>] -/
@[reducible, rust_trait_impl
  "core::iter::traits::collect::IntoIterator<@I, @Clause0_Item, @I>"]
def core.iter.traits.collect.IntoIterator.Blanket {I : Type} {Clause0_Item :
  Type} (iteratorIteratorInst : core.iter.traits.iterator.Iterator I
  Clause0_Item) : core.iter.traits.collect.IntoIterator I Clause0_Item I := {
  iteratorIteratorInst := iteratorIteratorInst
  into_iter := core.iter.traits.collect.IntoIterator.Blanket.into_iter
    iteratorIteratorInst
}

/- Trait declaration: [core::iter::traits::collect::Extend]
   Source: '/rustc/library/core/src/iter/traits/collect.rs', lines 394:0-394:19
   Name pattern: [core::iter::traits::collect::Extend] -/
@[rust_trait "core::iter::traits::collect::Extend"]
structure core.iter.traits.collect.Extend (Self : Type) (A : Type) where
  extend : forall {T : Type} {Clause0_IntoIter : Type} (IntoIteratorInst :
    core.iter.traits.collect.IntoIterator T A Clause0_IntoIter), Self → T →
    Result Self

/- Trait declaration: [core::iter::traits::double_ended::DoubleEndedIterator]
   Source: '/rustc/library/core/src/iter/traits/double_ended.rs', lines 41:0-41:39
   Name pattern: [core::iter::traits::double_ended::DoubleEndedIterator] -/
@[rust_trait "core::iter::traits::double_ended::DoubleEndedIterator"
  (parentClauses := ["iteratorIteratorInst"])]
structure core.iter.traits.double_ended.DoubleEndedIterator (Self : Type)
  (Self_Clause0_Item : Type) where
  iteratorIteratorInst : core.iter.traits.iterator.Iterator Self
    Self_Clause0_Item
  next_back : Self → Result ((Option Self_Clause0_Item) × Self)

/- Trait declaration: [core::iter::traits::exact_size::ExactSizeIterator]
   Source: '/rustc/library/core/src/iter/traits/exact_size.rs', lines 86:0-86:37
   Name pattern: [core::iter::traits::exact_size::ExactSizeIterator] -/
@[rust_trait "core::iter::traits::exact_size::ExactSizeIterator"
  (parentClauses := ["iteratorIteratorInst"])]
structure core.iter.traits.exact_size.ExactSizeIterator (Self : Type)
  (Self_Clause0_Item : Type) where
  iteratorIteratorInst : core.iter.traits.iterator.Iterator Self
    Self_Clause0_Item

/- [iterators_scalar::iter]: loop 0:
   Source: 'tests/src/iterators-scalar.rs', lines 4:4-4:20 -/
def iter_loop (iter1 : core.ops.range.Range Usize) : Result Unit := do
  let (o, iter2) ←
    core.iter.range.IteratorcoreopsrangeRangeA.next core.iter.range.StepUsize
      iter1
  match o with
  | none => ok ()
  | some _ => iter_loop iter2
partial_fixpoint

/- [iterators_scalar::iter]:
   Source: 'tests/src/iterators-scalar.rs', lines 3:0-5:1 -/
def iter (n : Usize) : Result Unit := do

    let iter1 ←
      core.iter.traits.collect.IntoIterator.Blanket.into_iter
        (core.iter.traits.iterator.IteratorcoreopsrangeRangeA
        core.iter.range.StepUsize) { start := 0#usize, end_ := n }
    iter_loop iter1

def test (p: Nat -> Bool) := Id.run do
  let mut n := 0
  while !p n do
    n := n + 1
  n

end iterators_scalar
