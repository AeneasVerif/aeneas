-- THIS FILE WAS AUTOMATICALLY GENERATED BY AENEAS
-- [list_borrows]
import Aeneas
open Aeneas Aeneas.Std Result ControlFlow Error
set_option linter.dupNamespace false
set_option linter.hashCommand false
set_option linter.unusedVariables false

/- You can set the `maxHeartbeats` value with the `-max-heartbeats` CLI option -/
set_option maxHeartbeats 1000000

namespace list_borrows

mutual

/- [list_borrows::LCell]
   Source: 'tests/src/list-borrows.rs', lines 3:0-6:1 -/
inductive LCell where
| mk : Std.I32 → List → LCell

/- [list_borrows::List]
   Source: 'tests/src/list-borrows.rs', lines 8:0-11:1 -/
@[discriminant isize]
inductive List where
| Nil : List
| Cons : LCell → List

end

def LCell.value (x : LCell) := match x with | LCell.mk x1 _ => x1

def LCell.next (x : LCell) := match x with | LCell.mk _ x1 => x1

@[simp]
theorem LCell.value._simpLemma_ (value : Std.I32) (next : List) :
  (LCell.mk value next).value = value := by rfl

@[simp]
theorem LCell.next._simpLemma_ (value : Std.I32) (next : List) :
  (LCell.mk value next).next = next := by rfl

/- [list_borrows::cons]:
   Source: 'tests/src/list-borrows.rs', lines 14:0-16:1 -/
def cons
  (value : Std.I32) (next : List) :
  Result (List × (List → (Std.I32 × List)))
  := do
  let back :=
    fun l =>
      let (i, l1) :=
        match l with
        | List.Cons (LCell.mk i1 l2) => (i1, l2)
        | _ => ((LCell.mk value next).value, (LCell.mk value next).next)
      ((LCell.mk i l1).value, (LCell.mk i l1).next)
  ok (List.Cons (LCell.mk (LCell.mk value next).value
    (LCell.mk value next).next), back)

/- [list_borrows::increment_list]: loop 0:
   Source: 'tests/src/list-borrows.rs', lines 19:4-22:5 -/
def increment_list_loop (l : List) : Result List := do
  match l with
  | List.Nil => ok List.Nil
  | List.Cons l1 =>
    let i ← l1.value + 1#i32
    let back ← increment_list_loop l1.next
    ok (List.Cons (LCell.mk i back))
partial_fixpoint

/- [list_borrows::increment_list]:
   Source: 'tests/src/list-borrows.rs', lines 18:0-23:1 -/
@[reducible]
def increment_list (l : List) : Result List := do
  increment_list_loop l

end list_borrows
